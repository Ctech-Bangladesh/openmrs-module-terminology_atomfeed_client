<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


    <changeSet id="terminology-atomfeed-client-1" author="John, Balaji">
        <insert tableName="scheduler_task_config">
            <column name="name" value="Terminology Feed Task"/>
            <column name="schedulable_class" value="org.bahmni.module.terminology.task.ConceptFeedTask"/>
            <column name="start_time" valueDate=" now() "/>
            <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss"/>
            <column name="repeat_interval" value="15"/>
            <column name="start_on_startup" value="1"/>
            <column name="started" value="1"/>
            <column name="created_by" value="1"/>
            <column name="date_created" valueDate=" now() "/>
            <column name="uuid" valueComputed=" uuid() "/>
        </insert>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-2" author="John, Utsab">
        <update tableName="scheduler_task_config">
            <column name="schedulable_class" value="org.bahmni.module.terminology.task.ConceptFeedTask"/>
            <where>name = "Terminology Feed Task"</where>
        </update>
    </changeSet>

    <changeSet id="terminology-atomfeed-chunking-history-3" author="John">
        <insert tableName="chunking_history">
            <column name="chunk_length" value="100"/>
            <column name="start" value="1"/>
        </insert>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-4" author="John, Utsab">
        <update tableName="scheduler_task_config">
            <column name="schedulable_class"
                    value="org.bahmni.module.terminology.infrastructure.atomfeed.ConceptFeedTask"/>
            <where>name = "Terminology Feed Task"</where>
        </update>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-5" author="BalajiN, Utsab">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">
                select count(*) from chunking_history;
            </sqlCheck>
        </preConditions>
        <sql>
            truncate chunking_history;
            insert into chunking_history (chunk_length, start) values (100, 1);
        </sql>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-6" author="BalajiN, Utsab">
        <sql>
            create table shr_concept_id_mapping(id MEDIUMINT AUTO_INCREMENT PRIMARY KEY, internal_id varchar(50),
            external_id varchar(50));
        </sql>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-7" author="Sumit, Balaji">
        <insert tableName="scheduler_task_config">
            <column name="name" value="Concept Reference Term Feed Feed Task"/>
            <column name="schedulable_class" value="org.bahmni.module.terminology.infrastructure.atomfeed.ConceptReferenceTermFeedTask"/>
            <column name="start_time" valueDate=" now() "/>
            <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss"/>
            <column name="repeat_interval" value="15"/>
            <column name="start_on_startup" value="1"/>
            <column name="started" value="1"/>
            <column name="created_by" value="1"/>
            <column name="date_created" valueDate=" now() "/>
            <column name="uuid" valueComputed=" uuid() "/>
        </insert>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-8" author="John">
        <insert tableName="scheduler_task_config">
            <column name="name" value="Terminology Feed Retry Task"/>
            <column name="schedulable_class" value="org.bahmni.module.terminology.infrastructure.atomfeed.ConceptFeedRetryTask"/>
            <column name="start_time" valueDate=" now() "/>
            <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss"/>
            <column name="repeat_interval" value="120"/>
            <column name="start_on_startup" value="1"/>
            <column name="started" value="1"/>
            <column name="created_by" value="1"/>
            <column name="date_created" valueDate=" now() "/>
            <column name="uuid" valueComputed=" uuid() "/>
        </insert>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-9" author="BalajiN, Utsab">
        <sql>
            drop table if exists shr_concept_id_mapping;
        </sql>
    </changeSet>

    <changeSet id="terminology-atomfeed-client-10" author="Neha" context="setup">
        <sql>
            update scheduler_task_config set repeat_interval = 13 where name = 'Concept Reference Term Feed Feed Task';
            update scheduler_task_config set repeat_interval = 31 where name = 'Terminology Feed Task';
        </sql>
    </changeSet>
</databaseChangeLog>